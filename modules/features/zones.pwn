#include <YSI_Coding\y_hooks>

hook OnGameModeInit()
{
    ZoneInfo[0][z_minx] = 1173;
    ZoneInfo[0][z_miny] = 371;
    ZoneInfo[0][z_maxx] = 1296;
    ZoneInfo[0][z_maxy] = 477;
    ZoneInfo[0][z_cp_x] = 1260.4614;
    ZoneInfo[0][z_cp_y] = 407.6312;
    ZoneInfo[0][z_cp_z] = 32.9776;

    ZoneInfo[1][z_minx] = 1296;
    ZoneInfo[1][z_miny] = 404;
    ZoneInfo[1][z_maxx] = 1365;
    ZoneInfo[1][z_maxy] = 477;
    ZoneInfo[1][z_cp_x] = 1334.0259;
    ZoneInfo[1][z_cp_y] = 437.3464;
    ZoneInfo[1][z_cp_z] = 19.2656;

    ZoneInfo[2][z_minx] = 1296;
    ZoneInfo[2][z_miny] = 371;
    ZoneInfo[2][z_maxx] = 1341;
    ZoneInfo[2][z_maxy] = 404;
    ZoneInfo[2][z_cp_x] = 1323.2012;
    ZoneInfo[2][z_cp_y] = 392.2362;
    ZoneInfo[2][z_cp_z] = 19.5547;

    ZoneInfo[3][z_minx] = 1341;
    ZoneInfo[3][z_miny] = 304;
    ZoneInfo[3][z_maxx] = 1365;
    ZoneInfo[3][z_maxy] = 404;
    ZoneInfo[3][z_cp_x] = 1358.7297;
    ZoneInfo[3][z_cp_y] = 333.6328;
    ZoneInfo[3][z_cp_z] = 20.5547;

    ZoneInfo[4][z_minx] = 1278;
    ZoneInfo[4][z_miny] = 319;
    ZoneInfo[4][z_maxx] = 1341;
    ZoneInfo[4][z_maxy] = 371;
    ZoneInfo[4][z_cp_x] = 1302.4327;
    ZoneInfo[4][z_cp_y] = 343.3603;
    ZoneInfo[4][z_cp_z] = 25.6946;

    ZoneInfo[5][z_minx] = 1365;
    ZoneInfo[5][z_miny] = 440;
    ZoneInfo[5][z_maxx] = 1414;
    ZoneInfo[5][z_maxy] = 477;
    ZoneInfo[5][z_cp_x] = 1393.4185;
    ZoneInfo[5][z_cp_y] = 465.4929;
    ZoneInfo[5][z_cp_z] = 20.1437;

    ZoneInfo[6][z_minx] = 1365;
    ZoneInfo[6][z_miny] = 368;
    ZoneInfo[6][z_maxx] = 1414;
    ZoneInfo[6][z_maxy] = 440;
    ZoneInfo[6][z_cp_x] = 1379.9146;
    ZoneInfo[6][z_cp_y] = 390.4728;
    ZoneInfo[6][z_cp_z] = 28.7555;

    ZoneInfo[7][z_minx] = 1414;
    ZoneInfo[7][z_miny] = 397;
    ZoneInfo[7][z_maxx] = 1496;
    ZoneInfo[7][z_maxy] = 477;
    ZoneInfo[7][z_cp_x] = 1466.7400;
    ZoneInfo[7][z_cp_y] = 444.1445;
    ZoneInfo[7][z_cp_z] = 22.9485;

    ZoneInfo[8][z_minx] = 1414;
    ZoneInfo[8][z_miny] = 317;
    ZoneInfo[8][z_maxx] = 1496;
    ZoneInfo[8][z_maxy] = 397;
    ZoneInfo[8][z_cp_x] = 0;
    ZoneInfo[8][z_cp_y] = 0;
    ZoneInfo[8][z_cp_z] = 0;

    ZoneInfo[9][z_minx] = 1365;
    ZoneInfo[9][z_miny] = 317;
    ZoneInfo[9][z_maxx] = 1414;
    ZoneInfo[9][z_maxy] = 368;
    ZoneInfo[9][z_cp_x] = 1368.6953;
    ZoneInfo[9][z_cp_y] = 328.2244;
    ZoneInfo[9][z_cp_z] = 21.0030;

    ZoneInfo[10][z_minx] = 1365;
    ZoneInfo[10][z_miny] = 287;
    ZoneInfo[10][z_maxx] = 1439;
    ZoneInfo[10][z_maxy] = 317;
    ZoneInfo[10][z_cp_x] = 1382.4747;
    ZoneInfo[10][z_cp_y] = 305.1288;
    ZoneInfo[10][z_cp_z] = 22.5555;

    ZoneInfo[11][z_minx] = 1229;
    ZoneInfo[11][z_miny] = 335;
    ZoneInfo[11][z_maxx] = 1278;
    ZoneInfo[11][z_maxy] = 371;
    ZoneInfo[11][z_cp_x] = 1259.2855;
    ZoneInfo[11][z_cp_y] = 357.3672;
    ZoneInfo[11][z_cp_z] = 23.5555;

    ZoneInfo[12][z_minx] = 1173;
    ZoneInfo[12][z_miny] = 335;
    ZoneInfo[12][z_maxx] = 1229;
    ZoneInfo[12][z_maxy] = 371;
    ZoneInfo[12][z_cp_x] = 1227.0121;
    ZoneInfo[12][z_cp_y] = 353.2835;
    ZoneInfo[12][z_cp_z] = 35.5191;

    ZoneInfo[13][z_minx] = 1439;
    ZoneInfo[13][z_miny] = 260;
    ZoneInfo[13][z_maxx] = 1496;
    ZoneInfo[13][z_maxy] = 317;
    ZoneInfo[13][z_cp_x] = 1460.7114;
    ZoneInfo[13][z_cp_y] = 271.2300;
    ZoneInfo[13][z_cp_z] = 19.1675;

    ZoneInfo[14][z_minx] = 1173;
    ZoneInfo[14][z_miny] = 274;
    ZoneInfo[14][z_maxx] = 1209;
    ZoneInfo[14][z_maxy] = 335;
    ZoneInfo[14][z_cp_x] = 1179.5271;
    ZoneInfo[14][z_cp_y] = 327.9113;
    ZoneInfo[14][z_cp_z] = 27.2508;

    ZoneInfo[15][z_minx] = 1278;
    ZoneInfo[15][z_miny] = 274;
    ZoneInfo[15][z_maxx] = 1301;
    ZoneInfo[15][z_maxy] = 319;
    ZoneInfo[15][z_cp_x] = 1294.3438;
    ZoneInfo[15][z_cp_y] = 295.0281;
    ZoneInfo[15][z_cp_z] = 27.5555;

    ZoneInfo[16][z_minx] = 1301;
    ZoneInfo[16][z_miny] = 245;
    ZoneInfo[16][z_maxx] = 1341;
    ZoneInfo[16][z_maxy] = 319;
    ZoneInfo[16][z_cp_x] = 1318.6965;
    ZoneInfo[16][z_cp_y] = 257.8930;
    ZoneInfo[16][z_cp_z] = 25.0555;

    ZoneInfo[17][z_minx] = 1399;
    ZoneInfo[17][z_miny] = 214;
    ZoneInfo[17][z_maxx] = 1439;
    ZoneInfo[17][z_maxy] = 287;
    ZoneInfo[17][z_cp_x] = 1428.3981;
    ZoneInfo[17][z_cp_y] = 252.6131;
    ZoneInfo[17][z_cp_z] = 32.4561;

    ZoneInfo[18][z_minx] = 1341;
    ZoneInfo[18][z_miny] = 214;
    ZoneInfo[18][z_maxx] = 1365;
    ZoneInfo[18][z_maxy] = 304;
    ZoneInfo[18][z_cp_x] = 1360.4661;
    ZoneInfo[18][z_cp_y] = 242.6955;
    ZoneInfo[18][z_cp_z] = 19.5669;

    ZoneInfo[19][z_minx] = 1365;
    ZoneInfo[19][z_miny] = 214;
    ZoneInfo[19][z_maxx] = 1399;
    ZoneInfo[19][z_maxy] = 287;
    ZoneInfo[19][z_cp_x] = 1375.6653;
    ZoneInfo[19][z_cp_y] = 255.2755;
    ZoneInfo[19][z_cp_z] = 24.2750;

    ZoneInfo[20][z_minx] = 1301;
    ZoneInfo[20][z_miny] = 200;
    ZoneInfo[20][z_maxx] = 1341;
    ZoneInfo[20][z_maxy] = 245;
    ZoneInfo[20][z_cp_x] = 1312.8135;
    ZoneInfo[20][z_cp_y] = 220.4762;
    ZoneInfo[20][z_cp_z] = 25.0223;

    ZoneInfo[21][z_minx] = 1222;
    ZoneInfo[21][z_miny] = 200;
    ZoneInfo[21][z_maxx] = 1301;
    ZoneInfo[21][z_maxy] = 274;
    ZoneInfo[21][z_cp_x] = 0;
    ZoneInfo[21][z_cp_y] = 0;
    ZoneInfo[21][z_cp_z] = 0;

    ZoneInfo[22][z_minx] = 1209;
    ZoneInfo[22][z_miny] = 274;
    ZoneInfo[22][z_maxx] = 1278;
    ZoneInfo[22][z_maxy] = 335;
    ZoneInfo[22][z_cp_x] = 1241.7764;
    ZoneInfo[22][z_cp_y] = 326.6162;
    ZoneInfo[22][z_cp_z] = 19.7555;

    ZoneInfo[23][z_minx] = 1173;
    ZoneInfo[23][z_miny] = 200;
    ZoneInfo[23][z_maxx] = 1222;
    ZoneInfo[23][z_maxy] = 274;
    ZoneInfo[23][z_cp_x] = 1199.2114;
    ZoneInfo[23][z_cp_y] = 242.6883;
    ZoneInfo[23][z_cp_z] = 19.5547;

    ZoneInfo[24][z_minx] = 1173;
    ZoneInfo[24][z_miny] = 96;
    ZoneInfo[24][z_maxx] = 1244;
    ZoneInfo[24][z_maxy] = 200;
    ZoneInfo[24][z_cp_x] = 1195.6024;
    ZoneInfo[24][z_cp_y] = 150.1254;
    ZoneInfo[24][z_cp_z] = 20.4758;

    ZoneInfo[25][z_minx] = 1244;
    ZoneInfo[25][z_miny] = 136;
    ZoneInfo[25][z_maxx] = 1341;
    ZoneInfo[25][z_maxy] = 200;
    ZoneInfo[25][z_cp_x] = 1294.3120;
    ZoneInfo[25][z_cp_y] = 174.2238;
    ZoneInfo[25][z_cp_z] = 20.9106;

    ZoneInfo[26][z_minx] = 1341;
    ZoneInfo[26][z_miny] = 168;
    ZoneInfo[26][z_maxx] = 1399;
    ZoneInfo[26][z_maxy] = 214;
    ZoneInfo[26][z_cp_x] = 1387.4810;
    ZoneInfo[26][z_cp_y] = 178.0304;
    ZoneInfo[26][z_cp_z] = 19.5095;

    ZoneInfo[27][z_minx] = 1244;
    ZoneInfo[27][z_miny] = 96;
    ZoneInfo[27][z_maxx] = 1341;
    ZoneInfo[27][z_maxy] = 136;
    ZoneInfo[27][z_cp_x] = 1338.5804;
    ZoneInfo[27][z_cp_y] = 127.0019;
    ZoneInfo[27][z_cp_z] = 27.0878;

    ZoneInfo[28][z_minx] = 1341;
    ZoneInfo[28][z_miny] = 96;
    ZoneInfo[28][z_maxx] = 1496;
    ZoneInfo[28][z_maxy] = 168;
    ZoneInfo[28][z_cp_x] = 1414.9597;
    ZoneInfo[28][z_cp_y] = 145.1922;
    ZoneInfo[28][z_cp_z] = 20.8732;

    ZoneInfo[29][z_minx] = 1399;
    ZoneInfo[29][z_miny] = 168;
    ZoneInfo[29][z_maxx] = 1496;
    ZoneInfo[29][z_maxy] = 214;
    ZoneInfo[29][z_cp_x] = 1434.4448;
    ZoneInfo[29][z_cp_y] = 188.9247;
    ZoneInfo[29][z_cp_z] = 21.8291;

    ZoneInfo[30][z_minx] = 1439;
    ZoneInfo[30][z_miny] = 214;
    ZoneInfo[30][z_maxx] = 1496;
    ZoneInfo[30][z_maxy] = 260;
    ZoneInfo[30][z_cp_x] = 1478.8613;
    ZoneInfo[30][z_cp_y] = 238.0277;
    ZoneInfo[30][z_cp_z] = 19.4633;

    for(new i = 0; i < N_ZONES; i++)
    {
        GangZoneCreate(ZoneInfo[i][z_minx], ZoneInfo[i][z_miny], ZoneInfo[i][z_maxx], ZoneInfo[i][z_maxy]);
        if(i != 8 && i != 21)
        {
            ZoneInfo[i][z_cp] = CreateDynamicCP(ZoneInfo[i][z_cp_x], ZoneInfo[i][z_cp_y], ZoneInfo[i][z_cp_z], 2);
            ZoneInfo[i][z_team] = -1;
            Streamer_SetIntData(STREAMER_TYPE_CP, ZoneInfo[i][z_cp], E_STREAMER_EXTRA_ID, i + ZONE_CP_EX_ID_OFFSET);
            ZoneInfo[i][z_textdraw] = TextDrawCreate(20, 300, "Test");
            TextDrawAlignment(ZoneInfo[i][z_textdraw], 1);
            TextDrawFont(ZoneInfo[i][z_textdraw], 1);
        }
        else ZoneInfo[i][z_cp] = -1;
        ZoneInfo[8][z_team] = 0;
        ZoneInfo[21][z_team] = 1;
        ZoneInfo[i][z_is_active] = false;
        ZoneInfo[i][z_progress] = 0;
        ZoneInfo[i][z_timer] = -1;
    }
}

hook OnPlayerConnect(playerid)
{
    for(new i = 0; i < N_ZONES; i++)
    {
        GangZoneShowForPlayer(playerid, i, (ZoneInfo[i][z_team] == -1)?(0xFFFFFF80):(ClassInfo[ZoneInfo[i][z_team]][color]));
    }
}

hook OnPlayerEnterDynamicCP(playerid, checkpointid)
{
    new zoneid = Streamer_GetIntData(STREAMER_TYPE_CP, checkpointid, E_STREAMER_EXTRA_ID);
    if(zoneid >= N_ZONES || zoneid < 0) return 1;
    if(GetPlayerTeam(playerid) != ZoneInfo[zoneid][z_team] && ZoneInfo[zoneid][z_is_active] == false) StartZoneCapture(zoneid, playerid);
    return 0;
}

stock StartZoneCapture(zoneid, playerid)
{
    TextDrawSetString(ZoneInfo[zoneid][z_textdraw], "Capturing... 0/100");
    TextDrawShowForPlayer(playerid, ZoneInfo[zoneid][z_textdraw]);
    ZoneInfo[zoneid][z_is_active] = true;
    ZoneInfo[zoneid][z_attacker] = playerid;
    ZoneInfo[zoneid][z_timer] = SetTimerEx("ZoneCaptureProgress", 1000, true, "i", zoneid);
    GangZoneFlashForAll(zoneid, ClassInfo[GetPlayerTeam(playerid)][color]);
}

forward ZoneCaptureProgress(zoneid);
public ZoneCaptureProgress(zoneid)
{
    new attacker_state = GetPlayerState(ZoneInfo[zoneid][z_attacker]);
    if(attacker_state != 7 && attacker_state != 9)
    {
        ZoneInfo[zoneid][z_progress] += 10;
        new string[20];
        format(string, sizeof(string), "Capturing... %d/100", ZoneInfo[zoneid][z_progress]);
        TextDrawSetString(ZoneInfo[zoneid][z_textdraw], string);
        TextDrawShowForPlayer(ZoneInfo[zoneid][z_attacker], ZoneInfo[zoneid][z_textdraw]);
    }
    if(ZoneInfo[zoneid][z_progress] >= 100) EndZoneCapture(zoneid, ZoneInfo[zoneid][z_attacker], true);
}

hook OnPlayerLeaveDynamicCP(playerid, checkpointid)
{
    new zoneid = Streamer_GetIntData(STREAMER_TYPE_CP, checkpointid, E_STREAMER_EXTRA_ID);
    if(zoneid >= N_ZONES || zoneid < 0) return 1;
    if(ZoneInfo[zoneid][z_attacker] == playerid) EndZoneCapture(zoneid, playerid, false);
    return 0;
}

stock EndZoneCapture(zoneid, playerid, bool:success)
{
    KillTimer(ZoneInfo[zoneid][z_timer]);
    GangZoneStopFlashForAll(zoneid);
    if(success) {
        GangZoneShowForAll(zoneid, ClassInfo[GetPlayerTeam(playerid)][color]);
        ZoneInfo[zoneid][z_team] = GetPlayerTeam(playerid);
    }
    TextDrawHideForPlayer(playerid, ZoneInfo[zoneid][z_textdraw]);
}

CMD:zone(playerid, params[])
{
    new zoneid;
    if(sscanf(params, "i", zoneid))
    {
        zoneid = 0;
    }
    GangZoneFlashForPlayer(playerid, zoneid, PASTEL_DEEP_GRAY);
}

CMD:nozone(playerid, params[])
{
    new zoneid;
    if(sscanf(params, "i", zoneid))
    {
        zoneid = 0;
    }
    GangZoneStopFlashForPlayer(playerid, zoneid);
}